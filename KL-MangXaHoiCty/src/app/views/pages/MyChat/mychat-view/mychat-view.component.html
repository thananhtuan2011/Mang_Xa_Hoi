
<style>
   
  .messages {
    background:lightgray;
    max-height:400px;
    overflow-y:scroll;
  }
  .clear
  {
      border-radius: 50%;
  }
.clear:hover
{

  border-radius: 50%;
  background:lightgray
}
.imgchat
{
  border-top: 2px solid #FFF;
  margin-left: -7px;
  height: 200px;
  width: 300px;
  margin-right: -7px;
      margin-bottom: -4px;
  
}
.onlyimg
{
  margin-top: -4px;

  margin-left: -7px;
  height: 200px;
  width: 300px;
  margin-right: -7px;
  margin-bottom: -4px;
}
.avatar.-online:after {
  margin-right: 480px;
        content: "";
        width: 10px;
        height: 10px;
        border: 1px solid #fff;
        -moz-border-radius: 6px;
        -webkit-border-radius: 6px;
        border-radius: 6px;
        position: absolute;
        right: -6px;
        top: 28px;
        background-color: #63b814;
        z-index: 100;
    }

    .avatar.-ofline:after {
      margin-right: 480px;
        content: "";
        width: 10px;
        height: 10px;
        /* border: 1px solid #fff; */
        -moz-border-radius: 6px;
        -webkit-border-radius: 6px;
        border-radius: 6px;
        position: absolute;
        right: -6px;
        top: 28px;
        /* background-color: #63b814; */
        z-index: 100;
    }

  

    </style>
   
  <div class="container">
     
      <div class="row pt-3" >
          <div  class="chat-main" style="width: 1040px; margin-left: 0px;">
              <div class="col-md-12 chat-header">
                  <div class="row header-one text-white p-1" style="    margin-top: 15px;">
                      <div class="col-md-6 name pl-2" style="display: flex;" *ngFor="let it of listTT_user_receive">
                        <span *ngIf="it.TinhTrang===true;then online;else offline">

                        </span>
                        <ng-template #online>
                          <div class="avatar -online">

                         
                          <span *ngIf="it.hinhanh===null;then e1; else e2"></span>
                          <ng-template #e2>
                            <img alt="" mat-card-avatar class="avatar" src="{{it.Avatar}}">
                          </ng-template>
                  
                          <ng-template #e1>
                            <img alt="" mat-card-avatar class="avatar" src="../../assets/media/users/avatar_macdinh.jpg">
                          </ng-template>
                        </div>
                          </ng-template>
                          <ng-template #offline>
                            <div class="avatar -ofline">

                           

                            <span *ngIf="it.hinhanh===null;then e1; else e2"></span>
                            <ng-template #e2>
                              <img alt="" mat-card-avatar class="avatar" src="{{it.Avatar}}">
                            </ng-template>
                    
                            <ng-template #e1>
                              <img alt="" mat-card-avatar class="avatar" src="../../assets/media/users/avatar_macdinh.jpg">
                            </ng-template>
                          </div>
                          </ng-template>
                        <!-- <i class="fa fa-comment"></i> -->
                          
                          <h6 style="    margin-top: 10px;" class="ml-1 mb-0">{{it.Username }}</h6>
                      </div>
                      <div class="col-md-6 options text-right pr-0">
                         
                          <p class="arrow-up mb-0">
                             
                          </p>
                         
                      </div>
                  </div>
                   <div class="row header-two w-120"> 
                      <div class="col-md-6 options-left pl-1">
                          <i class="fa fa-video-camera mr-3"></i>
                          
                         
                      </div>
                      <div class="col-md-6 options-right text-right pr-2" style="height: 20px;">
                          <!-- <i class="fa fa-cog"></i> -->
                          <button class="action" mat-icon-button [matMenuTriggerFor]="menu2" aria-label="Example icon-button with a menu">
                              <i style=" margin-top: -25px;" class="fa fa-cog"></i>
                            </button>
                            <mat-menu #menu2="matMenu">
                              <button mat-menu-item (click)="creaFormDelete()">
                                <mat-icon style="color:rgb(238, 26, 61)" >delete_forever</mat-icon>
                                <span>Xóa cuộc trò chuyện</span>
                              </button>
                           
                              <!-- <button mat-menu-item>
                                <mat-icon style="color:rgb(238, 26, 192)">edit</mat-icon>
                                <span>Chặn</span>
                              </button> -->
                            </mat-menu>
                      </div>
                  </div>
              </div>
  
              
              <div class="chat-content   "
            
             
           >
                   <div class="col-md-12 chats pt-3 pl-2 pr-3 pb-3 messages" style="height: 345px;"   #scroll >
                      <div  *ngFor="let ms of list_messenger;let vi=index;"   >
                          <!-- tin nhắn icon -->
                       
                        
                      <!-- tin nhắn text -->
                       <ul class="p-0 " *ngIf="ms.message!=null">
                           <li class="send-msg float-right mb-2 comment comment-string " style="display: flex;">
                              <button (click)="Scrolltr()"class="action" mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                                  <mat-icon>more_vert</mat-icon>
                                </button>
                                <mat-menu #menu="matMenu">
                                  <button mat-menu-item (click)="Create_Delete(ms.idchat)">
                                    <mat-icon style="color:rgb(238, 26, 61);margin-left:5px" >delete_forever</mat-icon>
                                    <span>Xóa</span>
                                  </button>
                               
                                  <button mat-menu-item (click)="Create_Edit(ms,vi)">
                                    <mat-icon style="color:rgb(238, 26, 192);margin-left:5px">edit</mat-icon>
                                    <span>Sửa</span>
                                  </button>
                                </mat-menu>
                          <!-- <mat-icon   matTooltip="Sửa nội dung bình luận" class="action">create</mat-icon> -->
                               <p class="pt-1 pb-1 pl-2 pr-2 m-0 rounded bg-primary" style="color: white;" *ngIf="ms.userid_send==id_user_current">
                                   <!-- Hii -->
                                  <span *ngIf="ms.hinhanh===null||ms.hinhanh==='';then ms1;else ms2"></span>
                                  <ng-template #ms1>
                                      {{ms.message}}
                                  </ng-template>
                                  <ng-template #ms2>
                                      <span  *ngIf="ms.message===null||ms.message==='';then s1;else s2"></span>
                                      <ng-template #s1>
                                          <img  class="onlyimg" src="{{ms.imgchat}}">
                                      </ng-template>
                                      <ng-template #s2>
                                          {{ms.message}}
                                          <br>
                                          <img class="imgchat" src="{{ms.imgchat}}">
                                      </ng-template>
                                  </ng-template>
                                   
                              
                              
                               </p>
                               
                                 
                           </li>
                          
                           <li class="receive-msg float-left mb-2" *ngIf="ms.userid_send==id_cr">
                               <div class="sender-img" *ngFor="let items of listTT_user_receive">
                                   <span ></span>
                                   <span
                                       *ngIf="items.hinhanh===null||items.hinhanh==='';then e1; else e2"></span>
                                   <ng-template #e2>
                                       <img src="{{items.Avatar}}"  class="float-left">
  
                                   </ng-template>
  
                                   <ng-template #e1>
  
                                       <img src="../../assets/media/users/avatar_macdinh.jpg"
                                       class="float-left">
  
                                   </ng-template>
                                   
                                       <!-- class="float-left"> -->
                               </div>
                               <div class="receive-msg-desc float-left ml-2 comment comment-string" style="display: flex;">
                                  
                                   <p class="bg-white m-0 pt-1 pb-1 pl-2 pr-2 rounded  ">
                                    

                                       <!-- {{ms.message}} -->
                                       <span *ngIf="ms.hinhanh===null||ms.hinhanh==='';then msg1;else msg2"></span>
                                       <ng-template #msg1>
                                           {{ms.message}}
                                       </ng-template>
                                       <ng-template #msg2>
                                           <span  *ngIf="ms.message===null||ms.message==='';then c1;else c2"></span>
                                           <ng-template #c1>
                                               <img  class="onlyimg" src="{{ms.imgchat}}">
                                           </ng-template>
                                           <ng-template #c2>
                                               {{ms.message}}
                                               <br>
                                               <img class="imgchat" src="{{ms.imgchat}}">
                                           </ng-template>
                                       </ng-template>
                                        
                                   
  
                                     
                                   </p>
                                   <button  (click)="Scrolltr()" class="action" mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                                      <mat-icon>more_vert</mat-icon>
                                    </button>
                                    <mat-menu #menu="matMenu">
                                      <button mat-menu-item (click)="Create_Delete(ms.idchat)">
                                        <mat-icon style="color:rgb(238, 26, 61);margin-left:5px" >delete_forever</mat-icon>
                                        <span>Xóa</span>
                                      </button>
                                   
                                      <button mat-menu-item (click)="Create_Edit(ms,vi)">
                                        <mat-icon style="color:rgb(238, 26, 192);margin-left:5px">edit</mat-icon>
                                        <span>Sửa</span>
                                      </button>
                                    </mat-menu>
                                   <!-- <span class="receive-msg-time">ketty, Jan 25, 6:20
                                       PM</span> -->
                               </div>
                           </li>
                          
                       </ul>
                      
                      </div>
                     
                        
                   
                   </div>
                   <div style="background: #ECEFF1;" class="col-md-12 p-2 msg-box ">
                      
                       <div class="row">
                          
                           <div class="col-options-left" style="margin-left: 15px;">
                               <i class="fa fa-smile-o"></i>
                             
                           </div>
                            
                           <div class="col-md-7 pl-0" style="display:flex">
                            
                              <div class='c-interaction'> 
                                  <button (click)="Open()" aria-label="Toggle more options." class='c-interaction__toggle c-interaction__button'><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><path d="M12 5v14M5 12h14"/></svg></button>
                                  <label class='vh' for='message'>Message:</label>
                                 
                                <input (blur)="onBlur()" (focus)="onFocus()" [(ngModel)]="noidung" (keydown.enter)="SendMessage()" style="color:rgb(32, 31, 31)" class='c-interaction__input' type='text'  placeholder='Message'>
                                  
                                  <div class='c-interaction__menu'>
                                    <ul>
                                      <li><button aria-label="Record a Video." class='c-interaction__button'><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-video"><path d="M23 7l-7 5 7 5V7z"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg></button></li>
                                      <li><button aria-label="Take a Picture." class='c-interaction__button'><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-camera"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg></button></li>
                                      <li>
                                          <button (click)="hiddenfileinput.click()" matTooltip="Upload File"  aria-label="Upload an Image." class='c-interaction__button'><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg></button>
                                          <input type='file' id="PDFInpdd" #hiddenfileinput (change)="onSelectFile_PDF($event)" style="display: none;">
                                      </li>
                                    </ul>
                                  </div>
                                </div>
                             
                              <!-- <input (blur)="onBlur()" (focus)="onFocus()" class="txt" matInput type="text" style="border-radius: 10px; border: 1px solid rgb(90, 33, 180)"  [(ngModel)]="noidung" (keydown.enter)="SendMessage()" style="height: 25px;    "  placeholder="Send Messengers"> -->
                             
                   
                          <button (click) ="toggleEmojiPicker()" mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                              <span style="font-size:20px">😀</span>
                            </button>
                            <mat-menu  #menu="matMenu">
                              <span (click)="$event.stopPropagation(); false;">
                                  <emoji-mart class="emoji-mart" set="{{set}}" (emojiSelect)="addEmoji($event)" title="Pick your emoji…"></emoji-mart>
                              </span>
                            
                          
                        
                            </mat-menu>
                            
                              <div  style="margin-top: -200px;" *ngIf="image">
                                  <div style="    float: right;
                                  margin-bottom: -100px;
                                 ">
                                  <button (click)="CloseIMG()" mat-icon-button>
                                      <mat-icon  class="clear">clear</mat-icon>
                                  </button>
                                     
                                  </div>
                                  <img style="width:200px;height: 200px;margin: 10px; border-radius: 5px;" [src]="image" >
                                  </div>  
                       
                           </div>
                        
     </div>
                   </div>
                  
               </div>
              
          </div>
        
      </div>
    
  </div>
  
     
      